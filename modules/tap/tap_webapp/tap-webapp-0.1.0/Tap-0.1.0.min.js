/*
 * TAP - v0.1.0 - 2012-12-18
 * http://tapintomuseums.org/
 * Copyright (c) 2011-2012 Indianapolis Museum of Art
 * GPLv3
 */
function AnalyticsTimer(e,t,n){return this.category=e,this.variable=t,this.label=n?n:undefined,this.start_time=null,this.elapsed=0,this.min_threshold=null,this.max_threshold=null,this.min_clamp=!1,this.max_clamp=!0,this}function loadXMLDoc(e){return xhttp=new XMLHttpRequest,xhttp.open("GET",e,!1),xhttp.send(),xhttp.responseXML}function objectToArray(e){if(e===undefined)return;return Object.prototype.toString.call(e)!=="[object Array]"?[e]:e}function xmlToJson(e,t){var n=!0,r=0;if(!t){t=["xml:"];for(r=0;r<e.documentElement.attributes.length;r++)e.documentElement.attributes.item(r).nodeName.indexOf("xmlns")!=-1&&t.push(e.documentElement.attributes.item(r).nodeName.replace("xmlns:","")+":")}var i=!0;if(e.attributes&&e.attributes.length>0){var s;i={};for(var o=0;o<e.attributes.length;o++)s=e.attributes.item(o),i[s.nodeName.replaceArray(t,"").toCamel()]=s.nodeValue}if(e.hasChildNodes()){var u,a,f;i===!0&&(i={});for(var l=0;l<e.childNodes.length;l++){f=e.childNodes.item(l);if((f.nodeType&7)===1)u=f.nodeName.replaceArray(t,"").toCamel(),a=xmlToJson(f,t),i.hasOwnProperty(u)?(i[u].constructor!==Array&&(i[u]=[i[u]]),i[u].push(a)):i[u]=a;else if((f.nodeType-1|1)===3){u="value",a=f.nodeType===3?f.nodeValue.replace(/^\s+|\s+$/g,""):f.nodeValue;if(i.hasOwnProperty(u))i[u]+=a;else if(f.nodeType===4||a!=="")i[u]=a}}}return i}function tapBasePath(){return script_src.indexOf("Init.js")>=0?"":"dist/"}AnalyticsTimer.prototype.start=function(){return this.start_time=(new Date).getTime(),this},AnalyticsTimer.prototype.stop=function(){return this.start_time!==null&&(this.elapsed=this.elapsed+(new Date).getTime()-this.start_time,this.start_time=null),this},AnalyticsTimer.prototype.reset=function(){return this.elapsed=0,this},AnalyticsTimer.prototype.send=function(){return this.stop(),(this.min_threshold===null||this.min_clamp||this.elapsed>=this.min_threshold)&&(this.max_threshold===null||this.max_clamp||this.elapsed<=this.max_threshold)&&(this.min_threshold!==null&&this.elapsed<this.min_threshold&&(this.elapsed=this.min_threshold),this.max_threshold!==null&&this.elapsed>this.max_threshold&&(this.elapsed=this.max_threshold),window._gaq.push(["_trackTiming",this.category,this.variable,this.elapsed,this.label])),this.start(),this},String.prototype.replaceArray=function(e,t){var n=this;for(var r=0;r<e.length;r++)n=n.replace(e[r],t);return n},String.prototype.toCamel=function(){return this.replace(/\s(.)/g,function(e){return e.toUpperCase()}).replace(/\s/g,"").replace(/^(.)/,function(e){return e.toLowerCase()})},typeof TapAPI=="undefined"&&(TapAPI={}),typeof TapAPI.models=="undefined"&&(TapAPI.models={}),TapAPI.models.Asset=Backbone.Model.extend({parse:function(e){return e.propertySet=new TapAPI.collections.PropertySet(e.propertySet,{id:e.id}),e.source&&(e.source=new TapAPI.collections.Sources(e.source,{id:e.id,asset:this})),e.content&&(e.content=new TapAPI.collections.Content(e.content,{id:e.id,asset:this})),e},getSourcesByPart:function(e){if(_.isUndefined(this.get("source")))return undefined;var t,n;return t=this.get("source").where({part:e,lang:tap.language}),t.length===0&&(t=this.get("source").where({part:e})),t.length&&(n=t),n},getContentsByPart:function(e){if(_.isUndefined(this.get("content")))return undefined;var t,n;return t=this.get("content").where({part:e,lang:tap.language}),t.length===0&&(t=this.get("content").where({part:e})),t.length&&(n=t),n},getSourcesByFormat:function(e){if(_.isUndefined(this.get("source")))return undefined;var t,n;return t=this.get("source").where({format:e,lang:tap.language}),t.length===0&&(t=this.get("source").where({format:e})),t.length&&(n=t),n},getContentsByFormat:function(e){if(_.isUndefined(this.get("content")))return undefined;var t,n;return t=this.get("content").where({format:e,lang:tap.language}),t.length===0&&(t=this.get("content").where({format:e})),t.length&&(n=t),n}}),typeof TapAPI=="undefined"&&(TapAPI={}),typeof TapAPI.models=="undefined"&&(TapAPI.models={}),TapAPI.models.Content=Backbone.Model.extend({initialize:function(){this.set("propertySet",new TapAPI.collections.PropertySet(this.get("propertySet"),{id:this.id})),this.get("data").value&&this.set("data",this.get("data").value)},getAsset:function(){return this.collection.asset},save:function(){this.collection.asset.save()},defaults:{lang:undefined,propertySet:undefined,data:undefined,format:undefined,lastModified:undefined,part:undefined}}),typeof TapAPI=="undefined"&&(TapAPI={}),typeof TapAPI.models=="undefined"&&(TapAPI.models={}),TapAPI.models.Property=Backbone.Model.extend({defaults:{name:undefined,value:undefined,lang:undefined}}),typeof TapAPI=="undefined"&&(TapAPI={}),typeof TapAPI.models=="undefined"&&(TapAPI.models={}),TapAPI.models.Source=Backbone.Model.extend({initialize:function(){this.set("propertySet",new TapAPI.collections.PropertySet(this.get("propertySet"),{id:this.id}))},getAsset:function(){return this.collection.asset},save:function(){this.collection.asset.save()},defaults:{lang:undefined,propertySet:undefined,uri:undefined,format:undefined,lastModified:undefined,part:undefined}}),typeof TapAPI=="undefined"&&(TapAPI={}),typeof TapAPI.models=="undefined"&&(TapAPI.models={}),TapAPI.models.Stop=Backbone.Model.extend({get:function(e){if(!this.attributes[e])return this.attributes[e];switch(e){case"description":case"title":if(this.attributes[e].length===0)return undefined;var t,n;return n=_.find(this.attributes[e],function(e){return e.lang===tap.language}),!n&&tap.language!==tap.defaultLanguage&&(n=_.find(this.attributes[e],function(e){return e.lang===tap.defaultLanguage})),n||(n=_.find(this.attributes[e],function(e){return e.lang===undefined||e.lang===""})),n&&(t=n.value),t;default:return this.attributes[e]}},parse:function(e){return e.propertySet=new TapAPI.collections.PropertySet(e.propertySet,{id:e.id}),e},getAssets:function(){if(_.isUndefined(this.get("assetRef")))return undefined;var e=[];return _.each(this.get("assetRef"),function(t){e.push(tap.tourAssets.get(t.id))}),_.isEmpty(e)?undefined:e},getAssetsByUsage:function(e){if(_.isUndefined(this.get("assetRef")))return undefined;var t=[];return _.each(this.get("assetRef"),function(n){n.usage===e&&t.push(tap.tourAssets.get(n.id))}),_.isEmpty(t)?undefined:t},getAssetsByType:function(e){if(_.isUndefined(this.get("assetRef")))return undefined;_.isArray(e)||(e=[e]);var t=[];return _.each(this.get("assetRef"),function(n){var r=tap.tourAssets.get(n.id);_.indexOf(e,r.get("type"))>-1&&t.push(r)}),_.isEmpty(t)?undefined:t},getSortedConnections:function(){return _.isUndefined(this.get("connections"))?undefined:_.sortBy(this.get("connection"),function(e){return parseInt(e.priority,10)})}}),typeof TapAPI=="undefined"&&(TapAPI={}),typeof TapAPI.models=="undefined"&&(TapAPI.models={}),TapAPI.models.Tour=Backbone.Model.extend({get:function(e){if(!this.attributes[e])return this.attributes[e];switch(e){case"description":case"title":if(this.attributes[e].length===0)return undefined;var t,n;return n=_.find(this.attributes[e],function(e){return e.lang===tap.language}),!n&&tap.language!==tap.defaultLanguage&&(n=_.find(this.attributes[e],function(e){return e.lang===tap.defaultLanguage})),n||(n=_.find(this.attributes[e],function(e){return e.lang===undefined||e.lang===""})),n&&(t=n.value),t;default:return this.attributes[e]}},parse:function(e){return e.propertySet=new TapAPI.collections.PropertySet(e.propertySet,{id:e.id}),e}}),typeof TapAPI=="undefined"&&(TapAPI={}),typeof TapAPI.collections=="undefined"&&(TapAPI.collections={}),TapAPI.collections.Assets=Backbone.Collection.extend({model:TapAPI.models.Asset,initialize:function(e,t){this.localStorage=new Backbone.LocalStorage(t+"-asset")}}),typeof TapAPI=="undefined"&&(TapAPI={}),typeof TapAPI.collections=="undefined"&&(TapAPI.collections={}),TapAPI.collections.Content=Backbone.Collection.extend({model:TapAPI.models.Content,initialize:function(e,t){this.localStorage=new Backbone.LocalStorage(t.id+"-source"),this.asset=t.asset}}),typeof TapAPI=="undefined"&&(TapAPI={}),typeof TapAPI.collections=="undefined"&&(TapAPI.collections={}),TapAPI.collections.PropertySet=Backbone.Collection.extend({model:TapAPI.models.Property,initialize:function(e,t){this.localStorage=new Backbone.LocalStorage(t.id+"-propertyset")},getValueByName:function(e){var t,n;return t=this.where({name:e,lang:tap.language}),t.length===0&&(t=this.where({name:e})),t.length&&(n=t[0].get("value")),n}}),typeof TapAPI=="undefined"&&(TapAPI={}),typeof TapAPI.collections=="undefined"&&(TapAPI.collections={}),TapAPI.collections.Sources=Backbone.Collection.extend({model:TapAPI.models.Source,initialize:function(e,t){this.localStorage=new Backbone.LocalStorage(t.id+"-source"),this.asset=t.asset}}),typeof TapAPI=="undefined"&&(TapAPI={}),typeof TapAPI.collections=="undefined"&&(TapAPI.collections={}),TapAPI.collections.Stops=Backbone.Collection.extend({model:TapAPI.models.Stop,initialize:function(e,t){this.localStorage=new Backbone.LocalStorage(t+"-stop")},getStopByKeycode:function(e){for(var t=0;t<this.models.length;t++){var n=this.models[t].get("propertySet").where({name:"code",value:e});if(n.length)return this.models[t]}return undefined}}),typeof TapAPI=="undefined"&&(TapAPI={}),typeof TapAPI.collections=="undefined"&&(TapAPI.collections={}),TapAPI.collections.Tours=Backbone.Collection.extend({model:TapAPI.models.Tour,localStorage:new Backbone.LocalStorage("tours"),selectTour:function(e){if(tap.currentTour==e)return;tap.currentTour=e,tap.tours.get(e).get("rootStopRef")&&(tap.currentStop=tap.tours.get(e).get("rootStopRef").id),tap.tourStops=new TapAPI.collections.Stops(null,e),tap.tourAssets=new TapAPI.collections.Assets(null,e),tap.tourAssets.fetch(),tap.tourStops.fetch(),tap.trigger("tap.tour.selected")}}),typeof TapAPI=="undefined"&&(TapAPI={}),typeof TapAPI.views=="undefined"&&(TapAPI.views={}),typeof TapAPI.views.registry=="undefined"&&(TapAPI.views.registry={}),jQuery(function(){TapAPI.views.Page=Backbone.View.extend({initialize:function(e){var t=null;tap.config.navbar_items!==undefined?t=tap.config.navbar_items:t=[{label:"Menu",endpoint:"tourstoplist"},{label:"Keypad",endpoint:"tourkeypad"},{label:"Map",endpoint:"tourmap"}];var n=!0,r=!1;tap.config.navbar_location!==undefined&&tap.config.navbar_location=="footer"&&(n=!1,r=!0),_.defaults(this.options,{page_title:"",back_label:"Back",nav_menu:t,active_index:null,header_nav:n,footer_nav:r}),this.onInit&&this.onInit()},close:function(){this.$el.empty().undelegate(),this.unbind(),this.undelegateEvents(),this.onClose&&this.onClose()},render:function(e){return this.$el.empty(),this.$el.html(TapAPI.templateManager.get("page")({title:this.options.page_title,back_label:this.options.back_label,header_nav:this.options.header_nav,footer_nav:this.options.footer_nav,nav_menu:this.options.nav_menu,active_index:this.options.active_index,tour_id:tap.currentTour})),this.renderContent(),$(document).live("pageshow",function(){var e=0;$items=$("#index-selector a").each(function(){e+=$(this).outerWidth()}),$("#index-selector .ui-controlgroup-controls").width(e)}),this},renderContent:function(){console.log("Warning: abstract TapApi.views.Page::renderContent")}})}),typeof TapAPI=="undefined"&&(TapAPI={}),typeof TapAPI.views=="undefined"&&(TapAPI.views={}),typeof TapAPI.views.registry=="undefined"&&(TapAPI.views.registry={}),TapAPI.views.registry.tour_audio_stop="AudioStop",TapAPI.views.registry.AudioStop="AudioStop",jQuery(function(){TapAPI.views.AudioStop=TapAPI.views.Page.extend({onInit:function(){tap.audio_timer===undefined&&(tap.audio_timer=new AnalyticsTimer("AudioStop","played_for",tap.currentStop.id)),tap.audio_timer.reset(),console.log("init")},renderContent:function(){var e=TapAPI.templateManager.get("audio-stop"),t=this.$el.find(":jqmData(role='content')"),n=this.model.getAssetsByUsage("transcription"),r=null;n!==undefined&&(r=n[0].get("content").at(0).get("data"));var i=null;n=this.model.getAssetsByUsage("image"),n!==undefined&&(i=n[0].get("source").at(0).get("uri")),t.append(e({tour_stop_title:this.model.get("title"),transcription:r,poster_image_path:i})),this.$el.find("#trans-button").click(function(){var e=$(".transcription").toggleClass("hidden");e.hasClass("hidden")?($(".ui-btn-text",this).text("Show Transcription"),_gaq.push(["_trackEvent","AudioStop","hide_transcription"])):($(".ui-btn-text",this).text("Hide Transcription"),_gaq.push(["_trackEvent","AudioStop","show_transcription"]))}),n=this.model.getAssetsByType(["tour_audio","tour_video"]);if(n){var s=this.$el.find("#audio-player"),o=this.$el.find("#video-player"),u;_.each(n,function(e){var t=e.get("source");t.each(function(e){var t="<source src='"+e.get("uri")+"' type='"+e.get("format")+"' />";switch(e.get("format").substring(0,5)){case"audio":s.append(t);break;case"video":o.append(t);break;default:console.log("Unsupported format for audio asset:",assetSource)}})});var a={flashName:tapBasePath()+mejs.MediaElementDefaults.flashName,silverlightName:tapBasePath()+mejs.MediaElementDefaults.flashName},f=null;o.find("source").length&&!s.find("source").length?(s.remove(),this.$el.find(".poster-image").remove(),o.show(),a.defaultVideoWidth="100%",a.defaultVideoHeight=270,f=o):(o.remove(),a.defaultAudioWidth="100%",f=s);var l=new MediaElementPlayer(f,a);f[0].addEventListener("loadedmetadata",function(){tap.audio_timer.max_threshold=f[0].duration*1e3}),f[0].addEventListener("play",function(){_gaq.push(["_trackEvent","AudioStop","media_started"]),tap.audio_timer.start()}),f[0].addEventListener("pause",function(){_gaq.push(["_trackEvent","AudioStop","media_paused"]),tap.audio_timer.stop()}),f[0].addEventListener("ended",function(){_gaq.push(["_trackEvent","AudioStop","media_ended"])}),l.play()}return this},onClose:function(){tap.audio_timer.send(),$(".me-plugin").remove()}})}),typeof TapAPI=="undefined"&&(TapAPI={}),typeof TapAPI.views=="undefined"&&(TapAPI.views={}),typeof TapAPI.views.registry=="undefined"&&(TapAPI.views.registry={}),jQuery(function(){TapAPI.views.Stop=TapAPI.views.Page.extend({renderContent:function(){var e=TapAPI.templateManager.get("stop");return this.$el.find(":jqmData(role='content')").append(e({tourStopTitle:this.model.get("title")?this.model.get("title"):undefined,tourStopDescription:this.model.get("description")?this.model.get("description"):undefined})),this}})}),typeof TapAPI=="undefined"&&(TapAPI={}),typeof TapAPI.views=="undefined"&&(TapAPI.views={}),typeof TapAPI.views.registry=="undefined"&&(TapAPI.views.registry={}),TapAPI.views.registry.tour_image_stop="ImageStop",TapAPI.views.registry.ImageStop="ImageStop",jQuery(function(){TapAPI.views.ImageStop=TapAPI.views.Page.extend({renderContent:function(){var e=tap.currentStop.get("assetRef"),t=TapAPI.templateManager.get("image-stop"),n=TapAPI.templateManager.get("image-stop-item");if(e){this.$el.find(":jqmData(role='content')").append(t());var r=this.$el.find("#Gallery");$.each(e,function(e){var t=tap.tourAssets.get(this.id);if(this.usage==="image_asset"){var i={},s=t.get("source"),o=t.get("content");s.each(function(e){switch(e.get("part")){case"image_asset_image":i.fullImageUri=e.get("uri")?e.get("uri"):"";break;case"thumbnail":i.thumbUri=e.get("uri")?e.get("uri"):""}}),o.each(function(e){console.log(e);switch(e.get("part")){case"title":i.title=e.get("data");break;case"caption":i.caption=e.get("caption")}}),r.append(n(i))}});var i=this.$el.find("#Gallery a").photoSwipe({enableMouseWheel:!1,enableKeyboard:!0,doubleTapZoomLevel:0,captionAndToolbarOpacity:.8,minUserZoom:0,preventSlideshow:!0,jQueryMobile:!0})}return this}})}),typeof TapAPI=="undefined"&&(TapAPI={}),typeof TapAPI.views=="undefined"&&(TapAPI.views={}),typeof TapAPI.views.registry=="undefined"&&(TapAPI.views.registry={}),jQuery(function(){TapAPI.views.Keypad=TapAPI.views.Page.extend({events:{"tap #gobtn":"submit","tap #keypad div .button":"writekeycode","tap #delete":"clearkeycode"},onInit:function(){this.options.active_index="tourkeypad"},renderContent:function(){var e=TapAPI.templateManager.get("keypad");$(":jqmData(role='content')",this.$el).append(e())},submit:function(){if(!$("#write").html())return;if(!tap.tourStops.getStopByKeycode($("#write").html())){tap.router.showDialog("error","This is an invalid code. Please enter another."),$("#write").html("");return}$destUrl="#tourstop/"+tap.currentTour+"/code/"+$("#write").html(),Backbone.history.navigate($destUrl,!0)},writekeycode:function(e){$("#write").html($("#write").html()+$(e.currentTarget).html())},clearkeycode:function(e){$("#write").html("")},close:function(){}})}),typeof TapAPI=="undefined"&&(TapAPI={}),typeof TapAPI.views=="undefined"&&(TapAPI.views={}),typeof TapAPI.views.registry=="undefined"&&(TapAPI.views.registry={}),jQuery(function(){TapAPI.views.Map=TapAPI.views.Page.extend({onInit:function(){this.options.active_index="tourmap",this.tile_layer=new L.TileLayer("http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:'Map data &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors, <a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, Imagery &copy; <a href="http://cloudmade.com">CloudMade</a>',maxZoom:18}),this.map=null,this.stop_markers={},this.stop_icons={},this.stop_popups={},this.stop_bounds=null,this.position_marker=null,this.view_initialized=!1,this.location_icon=L.divIcon({className:"location-icon"}),this.stop_icon=L.divIcon({className:"stop-icon"}),_.defaults(this.options,{"init-lat":null,"init-lon":null,"init-zoom":2})},renderContent:function(){TapAPI.geoLocation.startLocating();var e=TapAPI.templateManager.get("tour-map");$(":jqmData(role='content')",this.$el).addClass("map-content").append(e()),$(":jqmData(role='page')").live("pageshow",{map_view:this},function(e){e.data.map_view.resizeContentArea(),e.data.map_view.map===null&&e.data.map_view.initMap(),setTimeout(e.data.map_view.resizeContentArea,2e3)}),$(window).bind("orientationchange resize",this.resizeContentArea)},initMap:function(){return this.map=new L.Map("tour-map"),this.map.addLayer(this.tile_layer),_.each(this.options.stops.models,this.plotTourStopMarker,this),TapAPI.geoLocation.active_stop_collection=this.options.stops,_.each(this.stop_markers,function(e){var t=e.getLatLng();this.stop_bounds===null?this.stop_bounds=new L.LatLngBounds(t,t):this.stop_bounds.extend(t)},this),this.options["init-lat"]===null||this.options["init-lon"]===null?this.stop_bounds!==null?this.map.fitBounds(this.stop_bounds):this.map.setView(L.latLng(0,0),this.options["init-zoom"]):this.map.setView(new L.LatLng(this.options["init-lat"],this.options["init-lon"]),this.options["init-zoom"]),_.each(this.options.stops.models,function(e){tap.tours.selectTour(e.get("tour"));if(e.getAssetsByUsage("geo")===undefined)return;this.updateStopMarker(e)},this),TapAPI.geoLocation.latest_location!==null&&this.onLocationFound(TapAPI.geoLocation.latest_location),TapAPI.geoLocation.on("gotlocation",this.onLocationFound,this),this},generateBubbleContent:function(e,t){t===undefined&&e.get("distance")&&(t=TapAPI.geoLocation.formatDistance(e.get("distance")));var n=TapAPI.templateManager.get("tour-map-marker-bubble");return n({title:e.get("title"),tour_id:e.get("tour"),stop_id:e.get("id"),distance:t===undefined?"":"Distance: "+t,stop_lat:e.get("location").lat,stop_lon:e.get("location").lng})},plotTourStopMarker:function(e){tap.tours.selectTour(e.get("tour"));var t=e.getAssetsByUsage("geo");if(t===undefined)return;var n=t[0].get("content");if(n===undefined)return;var r=$.parseJSON(n.at(0).get("data"));if(r.type=="Point"){var i=L.divIcon({className:"stop-icon "+e.id}),s=new L.LatLng(r.coordinates[1],r.coordinates[0]),o=new L.Marker(s,{icon:i}),u=new L.Popup;u.setLatLng(s),u.setContent(this.generateBubbleContent(e)),this.stop_popups[e.id]=u,o.stop_id=e.id,o.addEventListener("click",this.onMarkerSelected,this),this.stop_icons[e.id]=i,this.stop_markers[e.id]=o,this.map.addLayer(o)}e.on("change:distance",this.updateStopMarker,this)},updateStopMarker:function(e){var t=undefined;e.get("distance")&&(t=TapAPI.geoLocation.formatDistance(e.get("distance"))),this.stop_popups[e.id].setContent(this.generateBubbleContent(e),t);var n=$(".stop-icon."+e.id+" .distance-label");n.length===0?(template=TapAPI.templateManager.get("tour-map-distance-label"),$(".stop-icon."+e.id).append(template({distance:t}))):n.html(t)},onMarkerSelected:function(e){_gaq.push(["_trackEvent","Map","marker_clicked",e.target.stop_id]),this.map.openPopup(this.stop_popups[e.target.stop_id]),$(".marker-bubble-content .directions a").on("click",function(){_gaq.push(["_trackEvent","Map","get_directions",e.target.stop_id])})},onLocationFound:function(e){var t=new L.LatLng(e.coords.latitude,e.coords.longitude);this.position_marker===null?(this.position_marker=new L.Marker(t,{icon:this.location_icon}),this.position_marker.bindPopup("You are here"),this.map.addLayer(this.position_marker),this.position_marker.addEventListener("click",function(){_gaq.push(["_trackEvent","Map","you_are_here_clicked"])})):this.position_marker.setLatLng(t)},onLocationError:function(e){console.log("onLocationError",e)},resizeContentArea:function(){var e,t,n,r,i;window.scroll(0,0);var s=$(":jqmData(role='page')");r=s.find(":jqmData(role='header'):visible"),n=s.find(":jqmData(role='footer'):visible"),e=s.find(":jqmData(role='content'):visible"),i=$(window).height(),t=i-r.outerHeight()-n.outerHeight(),s.find(":jqmData(role='content')").first().height(t)},onClose:function(){TapAPI.geoLocation.stopLocating(),$(window).unbind("orientationchange resize",this.resizeContentArea)}})}),typeof TapAPI=="undefined"&&(TapAPI={}),typeof TapAPI.views=="undefined"&&(TapAPI.views={}),typeof TapAPI.views.registry=="undefined"&&(TapAPI.views.registry={}),TapAPI.views.registry.tour_stop_group="StopGroup",TapAPI.views.registry.StopGroup="StopGroup",jQuery(function(){TapAPI.views.StopGroup=TapAPI.views.Page.extend({renderContent:function(){var e=TapAPI.templateManager.get("stop-group"),t={tourStopTitle:this.model.get("title")},n=this.model.get("description");n!==undefined?t.description=n:t.description="",this.$el.find(":jqmData(role='content')").append(e(t));var r=this.model.get("connection"),i=this.$el.find("#stop-list");_.each(r,function(e){var t=tap.tourStops.get(e.destId);if(t){var n=new TapAPI.views.StopGroupListItem({model:t});i.append(n.render().$el)}})}}),TapAPI.views.StopGroupListItem=Backbone.View.extend({tagName:"li",template:TapAPI.templateManager.get("stop-group-list-item"),render:function(){return this.$el.html(this.template({title:this.model.get("title")?this.model.get("title"):undefined,id:this.model.get("id"),tourId:tap.currentTour})),this}})}),typeof TapAPI=="undefined"&&(TapAPI={}),typeof TapAPI.views=="undefined"&&(TapAPI.views={}),typeof TapAPI.views.registry=="undefined"&&(TapAPI.views.registry={}),jQuery(function(){TapAPI.views.StopList=TapAPI.views.Page.extend({events:{"change #proximity-toggle":"onToggleProximity"},onInit:function(){this.options=_.defaults(this.options,{active_index:"tourstoplist",codes_only:!0,enable_proximity_order:!0,sort:"default"});var e=!1;_.each(tap.tourStops.models,function(t){t.getAssetsByUsage("geo")!==undefined&&(e=!0)}),e===!1&&(this.options.enable_proximity_order=!1),this.options.enable_proximity_order&&TapAPI.geoLocation.on("gotlocation",this.onLocationFound,this),this.stoplistitems={},tap.tourStops.comparator=this.sortByCode,tap.tourStops.sort()},renderContent:function(){var e=TapAPI.templateManager.get("tour-stop-list");this.$el.find(":jqmData(role='content')").append(e({enable_proximity_order:this.options.enable_proximity_order}));var t=this.$el.find("#tour-stop-list");this.addStopsToList(t),this.options.enable_proximity_order&&TapAPI.geoLocation.startLocating()},addStopsToList:function(e){_.each(tap.tourStops.models,function(t){if(this.options.codes_only){var n=t.get("propertySet").where({name:"code"});if(!n.length)return}var r=this.stoplistitems[t.id];r===undefined?(r=new TapAPI.views.StopListItem({model:t}),this.stoplistitems[t.id]=r,e.append(r.render().el),t.get("nearest")&&r.$el.addClass("nearest"),this.options.enable_proximity_order&&(t.on("change:distance",this.onStopDistanceChanged,r),t.on("change:nearest",this.onNearestStopChanged,r))):e.append(r.render().el)},this),$("#tour-stop-list").listview("refresh")},sortByCode:function(e){var t=e.get("propertySet").where({name:"code"});return t.length?t[0].get("value"):1e4},sortByDistance:function(e){var t=e.get("distance");return t===undefined?-1:t},onToggleProximity:function(){this.options.sort=="default"?(this.options.sort="proximity",tap.tourStops.comparator=this.sortByDistance,tap.tourStops.sort()):(this.options.sort="default",tap.tourStops.comparator=this.sortByCode,tap.tourStops.sort());var e=this.$el.find("#tour-stop-list");for(var t in this.stoplistitems)this.stoplistitems[t].remove(),delete this.stoplistitems[t],this.stoplistitems[t]=undefined;this.addStopsToList(e)},onStopDistanceChanged:function(e,t){var n=$("#stoplistitem-"+e.get("id")+" .ui-btn-text a","#tour-stop-list"),r=$("span.distance",n);r.length?r.html(TapAPI.geoLocation.formatDistance(t)):n.append("<span class='distance'>"+TapAPI.geoLocation.formatDistance(t)+"</span>")},onNearestStopChanged:function(e){e.get("nearest")?this.$el.addClass("nearest"):this.$el.removeClass("nearest")},onLocationFound:function(e){var t=new L.LatLng(e.coords.latitude,e.coords.longitude)},onClose:function(){TapAPI.geoLocation.stopLocating()}}),TapAPI.views.StopListItem=Backbone.View.extend({tagName:"li",template:TapAPI.templateManager.get("tour-stop-list-item"),render:function(){return this.$el.attr("id","stoplistitem-"+this.model.get("id")),this.$el.html(this.template({title:this.model.get("title")?this.model.get("title"):undefined,stop_id:this.model.get("id"),tour_id:tap.currentTour,distance:TapAPI.geoLocation.formatDistance(this.model.get("distance"))})),$("#tour-stop-list").listview("refresh"),this}})}),typeof TapAPI=="undefined"&&(TapAPI={}),typeof TapAPI.views=="undefined"&&(TapAPI.views={}),typeof TapAPI.views.registry=="undefined"&&(TapAPI.views.registry={}),jQuery(function(){TapAPI.views.TourDetails=TapAPI.views.Page.extend({onInit:function(){this.options.page_title=this.model.get("title"),this.options.header_nav=!1,this.options.footer_nav=!1},renderContent:function(){var e=TapAPI.templateManager.get("tour-details");this.$el.find(":jqmData(role='content')").append(e({tour_index:tap.config.default_nav_item,tour_id:this.model.id,publishDate:this.model.get("publishDate")?this.model.get("publishDate"):undefined,description:this.model.get("description")?this.model.get("description"):undefined,stopCount:tap.tourStops.length,assetCount:tap.tourAssets.length}))}})}),typeof TapAPI=="undefined"&&(TapAPI={}),typeof TapAPI.views=="undefined"&&(TapAPI.views={}),typeof TapAPI.views.registry=="undefined"&&(TapAPI.views.registry={}),jQuery(function(){TapAPI.views.TourList=TapAPI.views.Page.extend({onInit:function(){this.options.page_title="Tour List",this.options.header_nav=!1,this.options.footer_nav=!1},renderContent:function(){var e=TapAPI.templateManager.get("tour-list");this.$el.find(":jqmData(role='content')").append(e);var t=this.$el.find("#tour-list");_.each(this.model.models,function(e){t.append((new TapAPI.views.TourListItem({model:e})).render().el)},this),$("#tour-list").listview("refresh")}}),TapAPI.views.TourListItem=Backbone.View.extend({tagName:"li",template:TapAPI.templateManager.get("tour-list-item"),render:function(){return this.$el.html(this.template({title:this.model.get("title")?this.model.get("title"):undefined,id:this.model.get("id")})),this}})}),typeof TapAPI=="undefined"&&(TapAPI={}),typeof TapAPI.views=="undefined"&&(TapAPI.views={}),typeof TapAPI.views.registry=="undefined"&&(TapAPI.views.registry={}),TapAPI.views.registry.tour_video_stop="VideoStop",TapAPI.views.registry.VideoStop="VideoStop",jQuery(function(){TapAPI.views.VideoStop=TapAPI.views.Page.extend({onInit:function(){tap.video_timer===undefined&&(tap.video_timer=new AnalyticsTimer("VideoStop","played_for",tap.currentStop.id)),tap.video_timer.reset()},renderContent:function(){var e=TapAPI.templateManager.get("video-stop"),t=this.model.getAssetsByUsage("transcription"),n=null;t!==undefined&&(n=t[0].get("content").at(0).get("data"));var r=tap.config.default_video_poster;t=this.model.getAssetsByUsage("image"),t!==undefined&&(r=t[0].get("source").at(0).get("uri")),this.$el.find(":jqmData(role='content')").append(e({tourStopTitle:this.model.get("title"),transcription:n,poster_image_path:r})),this.$el.find("#trans-button").click(function(){var e=$(".transcription").toggleClass("hidden");e.hasClass("hidden")?($(".ui-btn-text",this).text("Show Transcription"),_gaq.push(["_trackEvent","VideoStop","hide_transcription"])):($(".ui-btn-text",this).text("Hide Transcription"),_gaq.push(["_trackEvent","VideoStop","show_transcription"]))}),t=this.model.getAssetsByType("tour_video");if(t.length){var i=this.$el.find("video");_.each(t,function(e){var t=e.get("source");t.each(function(e){i.append("<source src='"+e.get("uri")+"' type='"+e.get("format")+"' />")})}),i[0].addEventListener("loadedmetadata",function(){tap.video_timer.max_threshold=i[0].duration*1e3}),i[0].addEventListener("play",function(){_gaq.push(["_trackEvent","VideoStop","media_started"]),tap.video_timer.start()},this),i[0].addEventListener("pause",function(){_gaq.push(["_trackEvent","VideoStop","media_paused"]),tap.video_timer.stop()}),i[0].addEventListener("ended",function(){_gaq.push(["_trackEvent","VideoStop","playback_ended"])})}return this},onClose:function(){tap.video_timer.send()}})}),jQuery(function(){AppRouter=Backbone.Router.extend({views:{},routes:{"":"list",map:"map","tour/:tour_id":"tourDetails","tourkeypad/:tour_id":"tourKeypad","tourstop/:tour_id/:stop_id":"tourStopById","tourstop/:tour_id/code/:stop_code":"tourStopByCode","tourmap/:tour_id":"tourMap","tourstoplist/:tour_id":"tourStopList"},bookmarkMode:!1,initialize:function(){$("#back-button").live("click",function(e){return e.preventDefault(),window.history.back(),!1}),this.firstPage=!0},list:function(){this.changePage(new TapAPI.views.TourList({model:tap.tours}))},map:function(){var e={stops:new TapAPI.collections.Stops};_.each(tap.tours.models,function(t){tap.tours.selectTour(t.id),_.each(tap.tourStops.models,function(t){var n=t.getAssetsByUsage("geo");n!==undefined&&e.stops.add(t)})}),this.changePage(new TapAPI.views.Map(e)),$("#index-selector").replaceWith("<h1 id='page-title' class='ui-title'>Map</h2>")},tourDetails:function(e){tap.tours.selectTour(e),this.changePage(new TapAPI.views.TourDetails({model:tap.tours.get(tap.currentTour)}))},tourKeypad:function(e){tap.tours.selectTour(e),this.changePage(new TapAPI.views.Keypad({model:tap.tours.get(tap.currentTour),page_title:"Enter a code"}))},tourStop:function(){var e=TapAPI.views.registry[tap.currentStop.get("view")];e===undefined&&(console.log("View not in registry: ",tap.currentStop.get("view")),e="Stop"),this.changePage(new TapAPI.views[e]({model:tap.currentStop,page_title:tap.tours.get(tap.currentTour).get("title")[0].value}))},tourStopById:function(e,t){tap.tours.selectTour(e),tap.currentStop=tap.tourStops.get(t),this.tourStop()},tourStopByCode:function(e,t){tap.tours.selectTour(e),tap.currentStop=tap.tourStops.getStopByKeycode(t),this.tourStop()},tourStopList:function(e){tap.tours.selectTour(e);var t={model:tap.tours.get(tap.currentTour)};tap.config.StopListView!==undefined&&(t=_.extend(t,tap.config.StopListView)),this.changePage(new TapAPI.views.StopList(t))},tourMap:function(e){tap.tours.selectTour(e);var t={stops:tap.tourStops},n=tap.tours.get(tap.currentTour);_.each(n.get("appResource"),function(e){if(e===undefined||e.usage!="geo")return;asset=tap.tourAssets.get(e.id);var n=asset.get("content");if(n===undefined)return;var r=$.parseJSON(n.at(0).get("data"));r.type=="Point"&&(t["init-lon"]=r.coordinates[0],t["init-lat"]=r.coordinates[1])}),_.each(n.get("propertySet").models,function(e){e.get("name")=="initial_map_zoom"&&(t["init-zoom"]=e.get("value"))}),this.changePage(new TapAPI.views.Map(t))},changePage:function(e){tap.currentView!==undefined&&tap.currentView.close(),tap.currentView=e,e.$el.attr("data-role","page"),e.render(),$("body").append(e.$el);var t=$.mobile.defaultPageTransition;this.firstPage&&(t="none",this.firstPage=!1);if(tap.config.analytics_id!==null){var n=Backbone.history.getFragment();_gaq.push(["_trackPageview","/#"+n])}$.mobile.changePage(e.$el,{changeHash:!1,transition:t})},showDialog:function(e,t){var n=TapAPI.templateManager.get("dialog")({id:e,content:t});$("body").append(n),$.mobile.changePage("#"+e,{changeHash:!1,transition:"pop"})}})});if(!tap){var tap={};tap.tours={},tap.tourAssets={},tap.tourStops={},tap.language="en",tap.defaultLanguage="en",tap.currentStop="",tap.currentTour="";var _gaq=_gaq||[],userLang=navigator.language?navigator.language:navigator.userLanguage;tap.language=userLang.split("-")[0];var script_src=$("head script").last().attr("src");script_src.indexOf("Init.js")>=0?tap.base_path="":(tap.base_path=script_src.substring(0,script_src.lastIndexOf("/"))+"/",console.log("TAP.js base path: "+tap.base_path)),_.extend(tap,Backbone.Events),tap.initApp=function(e,t){tap.url=e,t===undefined&&(t={}),tap.config=_.defaults(t,{navbar_items:[{label:"Menu",endpoint:"tourstoplist"},{label:"Keypad",endpoint:"tourkeypad"},{label:"Map",endpoint:"tourmap"}],geolocation:{enableHighAccuracy:!0},navbar_location:"header",default_nav_item:"tourstoplist",default_video_poster:"assets/images/tapPoster.png",units:"si",analytics_id:null}),tap.initAnalytics(),TapAPI.geoLocation!==undefined&&tap.on("tap.tour.selected",TapAPI.geoLocation.parseCurrentStopLocations),tap.trigger("tap.init.start"),tap.tours=new TapAPI.collections.Tours,tap.tours.fetch();var n=xmlToJson(loadXMLDoc(tap.url)),r,i;if(n.tour)tap.initModels(n.tour);else if(n.tourSet&&n.tourSet.tourRef){i=n.tourSet.tourRef.length;for(r=0;r<i;r++){var s=xmlToJson(loadXMLDoc(n.tourSet.tourRef[r].uri));tap.initModels(s.tour)}}else if(n.tourSet&&n.tourSet.tour){i=n.tourSet.tour.length;for(r=0;r<i;r++)tap.initModels(n.tourSet.tour[r])}tap.trigger("tap.init.end"),tap.router=new AppRouter},tap.initModels=function(e){var t=tap.tours.get(e.id);if(t&&Date.parse(e.lastModified)<=Date.parse(t.get("lastModified")))return;var n=new TapAPI.collections.Stops(null,e.id),r=new TapAPI.collections.Assets(null,e.id);tap.tours.get(e.id)&&(tap.tours.get(e.id).destroy(),n.fetch(),n.each(function(e){e.destroy()}),r.fetch(),r.each(function(e){e.destroy()})),tap.trigger("tap.init.create-tour",{id:e.id}),tap.tours.create({id:e.id,appResource:e.tourMetadata&&e.tourMetadata.appResource?objectToArray(e.tourMetadata.appResource):undefined,connection:objectToArray(e.connection),description:e.tourMetadata&&e.tourMetadata.description?objectToArray(e.tourMetadata.description):undefined,lastModified:e.tourMetadata&&e.tourMetadata.lastModified?e.tourMetadata.lastModified:undefined,propertySet:e.tourMetadata&&e.tourMetadata.propertySet?objectToArray(e.tourMetadata.propertySet.property):undefined,publishDate:e.tourMetadata&&e.tourMetadata.publishDate?objectToArray(e.tourMetadata.publishDate):undefined,rootStopRef:e.tourMetadata&&e.tourMetadata.rootStopRef?e.tourMetadata.rootStopRef:undefined,title:e.tourMetadata&&e.tourMetadata.title?objectToArray(e.tourMetadata.title):undefined});var i,s,o=e.stop.length;for(i=0;i<o;i++){var u=[];if(!_.isUndefined(e.connection))for(s=0;s<e.connection.length;s++)e.connection[s].srcId==e.stop[i].id&&u.push({priority:e.connection[s].priority,destId:e.connection[s].destId});n.create({id:e.stop[i].id,connection:u,view:e.stop[i].view,description:objectToArray(e.stop[i].description),propertySet:e.stop[i].propertySet?objectToArray(e.stop[i].propertySet.property):undefined,assetRef:objectToArray(e.stop[i].assetRef),title:objectToArray(e.stop[i].title),tour:e.id})}var a=e.asset.length;for(i=0;i<a;i++){if(e.asset[i].source){e.asset[i].source=objectToArray(e.asset[i].source);var f=e.asset[i].source.length;for(s=0;s<f;s++)e.asset[i].source[s].propertySet&&(e.asset[i].source[s].propertySet=objectToArray(e.asset[i].source[s].propertySet.property))}if(e.asset[i].content){e.asset[i].content=objectToArray(e.asset[i].content);var l=e.asset[i].content.length;for(s=0;s<l;s++)e.asset[i].content[s].propertySet&&(e.asset[i].content[s].propertySet=objectToArray(e.asset[i].content[s].propertySet.property))}r.create({assetRights:objectToArray(e.asset[i].assetRights),content:e.asset[i].content,id:e.asset[i].id,source:e.asset[i].source,propertySet:e.asset[i].propertySet?objectToArray(e.asset[i].propertySet.property):undefined,type:e.asset[i].type})}n.reset(),r.reset()},tap.initAnalytics=function(){if(tap.config.analytics_id===null)return;_gaq.push(["_setAccount",tap.config.analytics_id]),function(e,t){var n=e.createElement(t),r=e.getElementsByTagName(t)[0];n.async=1,n.src=("https:"==location.protocol?"//ssl":"//www")+".google-analytics.com/ga.js",r.parentNode.insertBefore(n,r)}(document,"script")}}typeof TapAPI=="undefined"&&(TapAPI={}),jQuery(function(){if(!navigator.geolocation)return;TapAPI.geoLocation={latest_location:null,watch:null,nearest_stop:null,active_stop_collection:null,locate:function(){navigator.geolocation.getCurrentPosition(TapAPI.geoLocation.locationReceived,TapAPI.geoLocation.locationError,{enableHighAccuracy:tap.config.geolocation.enableHighAccuracy})},locationReceived:function(e){TapAPI.geoLocation.latest_location=e,TapAPI.geoLocation.computeStopDistance(e),TapAPI.geoLocation.trigger("gotlocation",e)},locationError:function(e){console.log("locationError",e)},parseCurrentStopLocations:function(){_.each(tap.tourStops.models,function(e){if(e.get("location")===undefined){var t=e.getAssetsByUsage("geo");if(t){var n=t[0].get("content");if(n===undefined)return;var r=$.parseJSON(n.at(0).get("data"));r.type=="Point"&&e.set("location",new L.LatLng(r.coordinates[1],r.coordinates[0]))}}})},computeStopDistance:function(e){var t=new L.LatLng(e.coords.latitude,e.coords.longitude),n=null,r=tap.tourStops;this.active_stop_collection!==null&&(r=this.active_stop_collection),_.each(r.models,function(e){var r=e.get("location");if(r!==undefined){var i=t.distanceTo(r);e.set("distance",i);if(n===null||i<n.get("distance"))n=e}}),n!==null&&(this.nearest_stop===null?this.nearest_stop=n:this.nearest_stop!=n&&this.nearest_stop.set("nearest",!1),n.set("nearest",!0))},startLocating:function(e){this.watch=navigator.geolocation.watchPosition(TapAPI.geoLocation.locationReceived,TapAPI.geoLocation.locationError,{enableHighAccuracy:tap.config.geolocation.enableHighAccuracy})},stopLocating:function(){navigator.geolocation.clearWatch(this.watch),this.nearest_stop!==null&&(this.nearest_stop.set("nearest",!1),this.nearest_stop=null)},formatDistance:function(e){if(e===undefined)return"";if(tap.config.units=="si")return e<100?parseInt(e,10)+" m":e<1e4?(e/1e3).toFixed(2)+" km":parseInt(e/1e3,10)+" km";var t=3.28084*e;return t>52800?parseInt(t/5280,10)+" mi":t>528?(t/5280).toFixed(2)+" mi":parseInt(t,10)+" ft"}},_.extend(TapAPI.geoLocation,Backbone.Events)}),typeof TapAPI=="undefined"&&(TapAPI={}),typeof TapAPI.templates=="undefined"&&(TapAPI.templates={}),TapAPI.templateManager={get:function(e){return TapAPI.templates[e]===undefined&&$.ajax({async:!1,dataType:"html",url:"js/backbone/templates/"+e+".tpl.html",success:function(t,n,r){TapAPI.templates[e]=_.template(t)}}),TapAPI.templates[e]}},typeof TapAPI=="undefined"&&(TapAPI={}),typeof TapAPI.templates=="undefined"&&(TapAPI.templates={}),TapAPI.templates["audio-stop"]=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+="<div class='tour-stop audio'>\n	<div class='title'>"+((__t=tour_stop_title)==null?"":__t)+'</div>\n	<audio id="audio-player" controls="controls">\n		<p>Your browser does not support the audio element.</p>\n	</audio>\n	<video id="video-player" autoplay controls="controls" style=\'display:none;\'\n	',poster_image_path!==null&&(__p+="\n		poster='"+((__t=poster_image_path)==null?"":__t)+"'\n	"),__p+="\n	>\n		<p>Your browser does not support the video element.</p>\n	</video>\n	",poster_image_path!==null&&(__p+='\n		<img class="poster-image" src="'+((__t=poster_image_path)==null?"":__t)+'" />\n	'),__p+="\n	",transcription!==null&&(__p+="\n		<div id='trans-button' data-role='button' class='ui-mini'>Show Transcription</div>\n		<div class='transcription hidden'><p>"+((__t=transcription)==null?"":__t)+"</p></div>\n	"),__p+="\n</div>";return __p},TapAPI.templates.dialog=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<div data-role="dialog" id="'+((__t=id)==null?"":__t)+'">\n	<div data-role="header" data-theme="d">\n		<h1></h1>\n	</div>\n	<div data-role="content" data-theme="c" align="center">\n		'+((__t=content)==null?"":__t)+"\n	</div>\n</div>";return __p},TapAPI.templates["image-stop-item"]=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='	<li>\n		<a href="'+((__t=fullImageUri)==null?"":__t)+'" rel="external"><img src="'+((__t=thumbUri)==null?"":__t)+'" alt="'+((__t=title)==null?"":__t)+'" title="'+((__t=title)==null?"":__t)+'" /></a>\n	</li>\n';return __p},TapAPI.templates["image-stop"]=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<ul id="Gallery" class="ui-grid-b">\n</ul>\n';return __p},TapAPI.templates.keypad=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<fieldset class="ui-grid-b" id="keypad" data-theme=\'d\'>\n	<div class="ui-block-a" id="writeStyle">\n		<div class="ui-bar" id="write"></div>\n	</div>\n	<div class="ui-block-b">\n		<div class="ui-bar ui-bar-d" id="gobtn">Go</div>	\n	</div>\n	<div class="ui-block-a"><div class="button ui-bar ui-bar-d">1</div></div>\n	<div class="ui-block-b"><div class="button ui-bar ui-bar-d">2</div></div>	 \n	<div class="ui-block-b"><div class="button ui-bar ui-bar-d">3</div></div>  \n	<div class="ui-block-a"><div class="button ui-bar ui-bar-d">4</div></div>\n	<div class="ui-block-b"><div class="button ui-bar ui-bar-d">5</div></div>	 \n	<div class="ui-block-b"><div class="button ui-bar ui-bar-d">6</div></div>  \n	<div class="ui-block-a"><div class="button ui-bar ui-bar-d">7</div></div>\n	<div class="ui-block-b"><div class="button ui-bar ui-bar-d">8</div></div>	 \n	<div class="ui-block-b"><div class="button ui-bar ui-bar-d">9</div></div>  \n	<div class="ui-block-a"><div class="button ui-bar ui-bar-d">0</div></div>\n	<div class="ui-block-b" id="clearStyle">\n		<div class="ui-bar ui-bar-d" id="delete">Clear</div>\n	</div>\n</fieldset>\n';return __p},TapAPI.templates.page=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<div data-role="header" data-id="tap-header" data-position="fixed">\n	<a id=\'back-button\' data-rel="back" data-mini="true">'+((__t=back_label)==null?"":__t)+"</a>\n	",header_nav?(__p+='\n	<div id=\'index-selector\' data-role="controlgroup" data-type="horizontal" data-mini="true">\n		',_.each(nav_menu,function(e){__p+='\n		<a data-role="button" '+((__t=active_index==e.endpoint?'data-theme="b"':"")==null?"":__t)+" href='#"+((__t=e.endpoint)==null?"":__t)+"/"+((__t=tour_id)==null?"":__t)+"'>"+((__t=e.label)==null?"":__t)+"</a>\n		"}),__p+="\n	</div>\n	"):__p+='\n	<h1 id="page-title">'+((__t=title)==null?"":__t)+"</h1>\n	",__p+='\n</div>\n<div data-role="content">\n</div>\n',footer_nav&&(__p+='\n<div data-role="footer" data-id="tap-footer" data-position="fixed">\n	<div data-role="navbar">\n		<ul>\n			',_.each(nav_menu,function(e){__p+="\n			<li><a "+((__t=active_index==e.endpoint?'data-theme="b"':"")==null?"":__t)+" href='#"+((__t=e.endpoint)==null?"":__t)+"/"+((__t=tour_id)==null?"":__t)+"'>"+((__t=e.label)==null?"":__t)+"</a></li>\n			"}),__p+="\n		</ul>\n	</div>\n</div>\n"),__p+="";return __p},TapAPI.templates["stop-group-list-item"]=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<a href="#tourstop/'+((__t=tourId)==null?"":__t)+"/"+((__t=id)==null?"":__t)+'">'+((__t=title)==null?"":__t)+"</a>\n";return __p},TapAPI.templates["stop-group"]=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+="<div class='tour-stop stop-group' style=\"width:100%;\">\n	<div class='title'>"+((__t=tourStopTitle)==null?"":__t)+"</div>\n	<div class='description'>"+((__t=description)==null?"":__t)+'</div>\n	<ul id="stop-list" class="ui-listview" data-inset="true" data-role="listview"></ul>\n</div>\n';return __p},TapAPI.templates.stop=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+="<div class='stop' style=\"width:100%;\">\n	<div class='title'>"+((__t=tourStopTitle)==null?"":__t)+"</div>\n	<div class='description'>"+((__t=tourStopDescription)==null?"":__t)+"</div>\n</div>\n";return __p},TapAPI.templates["tour-details"]=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<div class="">			\n	<a href="#'+((__t=tour_index)==null?"":__t)+"/"+((__t=tour_id)==null?"":__t)+'" id="start-tour" data-role="button" data-theme="b">Start Tour</a>\n</div>\n<div class=\'tour-details\'>\n	'+((__t=description)==null?"":__t)+"\n</div>\n";return __p},TapAPI.templates["tour-list-item"]=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<a href="#tour/'+((__t=id)==null?"":__t)+'">'+((__t=title)==null?"":__t)+"</a>\n";return __p},TapAPI.templates["tour-list"]=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<ul id="tour-list" class="ui-listview" data-inset="true" data-role="listview"></ul>';return __p},TapAPI.templates["tour-map-distance-label"]=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+="<div class='distance-label-container'>\n<div class='distance-label'>"+((__t=distance)==null?"":__t)+"</div>\n</div>";return __p},TapAPI.templates["tour-map-marker-bubble"]=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+="<div class='marker-bubble-content'>\n	<div class='title'>"+((__t=title)==null?"":__t)+"</div>\n	<div class='distance'>"+((__t=distance)==null?"":__t)+"</div>\n	<div class='view-button'><a href='#tourstop/"+((__t=tour_id)==null?"":__t)+"/"+((__t=stop_id)==null?"":__t)+"'>View stop</a></div>\n	<div class='directions'>\n		<a href='http://maps.google.com/maps?saddr=Current%20Location&daddr="+((__t=stop_lat)==null?"":__t)+","+((__t=stop_lon)==null?"":__t)+"'>Get Directions</a>\n	</div>\n</div>";return __p},TapAPI.templates["tour-map"]=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+="<div id='tour-map'>Unable to display the map</div>";return __p},TapAPI.templates["tour-stop-list-item"]=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+="<a href='#tourstop/"+((__t=tour_id)==null?"":__t)+"/"+((__t=stop_id)==null?"":__t)+"'>"+((__t=title)==null?"":__t)+"\n",distance!==""&&(__p+="\n<span class='distance'>"+((__t=distance)==null?"":__t)+"</span>\n"),__p+="\n</a>";return __p},TapAPI.templates["tour-stop-list"]=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<ul id="tour-stop-list" class="ui-listview" data-inset="true" data-role="listview"></ul>\n',enable_proximity_order&&(__p+='\n<div data-role="fieldcontain" id=\'proximity-container\'>\n<label for="proximity-toggle">Distance ordering:</label>\n<select name="proximity-toggle" id="proximity-toggle" data-role="slider">\n	<option value="off">Off</option>\n	<option value="on">On</option>\n</select> \n</div>\n'),__p+="";return __p},TapAPI.templates["video-stop"]=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+="<div class='tour-stop video'>\n	<div class='title'>"+((__t=tourStopTitle)==null?"":__t)+'</div>\n	<video id="video-player" controls="controls" autoplay="autoplay"\n	',poster_image_path!==null&&(__p+="\n		poster='"+((__t=poster_image_path)==null?"":__t)+"'\n	"),__p+="\n	>\n		<p>Your browser does not support the video tag.</p>\n	</video>\n	",transcription!==null&&(__p+="\n		<div id='trans-button' data-role='button' class='ui-mini'>Show Transcription</div>\n		<div class='transcription hidden'><p>"+((__t=transcription)==null?"":__t)+"</p></div>\n	"),__p+="\n</div>\n";return __p};